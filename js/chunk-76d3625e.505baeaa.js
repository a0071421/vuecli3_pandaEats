(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-76d3625e"],{"51ef":function(t,a,e){"use strict";e.r(a);var s=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("div",{staticClass:"container mt-4"},[e("loading",{attrs:{active:t.isLoading},on:{"update:active":function(a){t.isLoading=a}}}),0===t.carts.carts.length?e("div",[e("div",{staticClass:"text-center"},[e("h3",{staticClass:"py-4"},[t._v("您的購物是空的唷")]),e("router-link",{staticClass:"btn btn-primary",attrs:{to:"/products"}},[t._v("趕快去看看")])],1)]):e("div",[e("ul",{staticClass:"step list-unstyled d-flex text-center"},[e("li",{staticClass:"step-item flex-grow-1 py-4",class:{active:"cart-list"===t.current}},[e("h4",[t._v("STEP/1")]),e("p",{staticClass:"mb-0"},[t._v("購物清單")])]),e("li",{staticClass:"step-item flex-grow-1 py-4",class:{active:"order-info"===t.current}},[e("h4",[t._v("STEP/2")]),e("p",{staticClass:"mb-0"},[t._v("填寫訂購資料")])]),t._m(0)]),"cart-list"===t.current?e("div",{staticClass:"mb-5"},[t.carts.carts.length?e("div",[e("table",{staticClass:"table checkout-cart-table"},[t._m(1),e("tbody",{staticClass:"checkout-cart-tbody"},t._l(t.carts.carts,(function(a,s){return e("tr",{key:a.id},[e("td",{staticClass:"align-middle"},[e("button",{staticClass:"btn btn-outline-danger btn-sm",attrs:{type:"button"},on:{click:function(e){return t.removeCart(a.id)}}},[e("i",{staticClass:"far fa-trash-alt"})])]),e("td",{staticClass:"align-middle d-none d-md-table-cell"},[e("div",{staticClass:"cart-img",style:{backgroundImage:"url("+a.imageUrl+")"}})]),e("td",{staticClass:"align-middle"},[t._v(" "+t._s(a.title)+" "),t.carts.total!==t.carts.finalTotal?e("div",{staticClass:"text-success"},[t._v(" 已套用優惠券-["+t._s(t.carts.coupon.coupon_code)+"] ")]):t._e()]),e("td",{staticClass:"align-middle"},[e("div",{staticClass:"form-group mb-0"},[e("select",{directives:[{name:"model",rawName:"v-model.number",value:a.qty,expression:"item.qty",modifiers:{number:!0}}],staticClass:"form-control form-control-sm",on:{change:[function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(a){var e="_value"in a?a._value:a.value;return t._n(e)}));t.$set(a,"qty",e.target.multiple?s:s[0])},function(e){return t.changePdNum(a,s)}]}},t._l(a.qty-a.qty%10+20,(function(a){return e("option",{key:a,domProps:{value:a}},[t._v(t._s(a))])})),0)])]),e("td",{staticClass:"align-middle text-right"},[t._v(" "+t._s(t._f("currency")(a.price))+" ")]),e("td",{staticClass:"align-middle text-right"},[t.carts.total===t.carts.finalTotal?e("div",[t._v(" "+t._s(t._f("currency")(a.price*a.qty))+" ")]):e("div",[e("del",[t._v(" "+t._s(t._f("currency")(a.price*a.qty))+" ")]),e("div",{staticClass:"mt-1 text-highlight"},[t._v(t._s(t._f("currency")(Math.floor(a.price*a.qty*t.carts.coupon.percent))))])])])])})),0)]),t.carts.total===t.carts.finalTotal?e("div",{staticClass:"text-right h5 text-highlight"},[t._v(" 總計: "+t._s(t._f("currency")(t.carts.total))+" ")]):e("div",{staticClass:"text-right h6"},[t._v(" 總計: "+t._s(t._f("currency")(t.carts.total))+" ")]),t.carts.total!==t.carts.finalTotal?e("hr"):t._e(),t.carts.total!==t.carts.finalTotal?e("div",{staticClass:"text-right h5 text-highlight"},[t._v(" 折扣價: "+t._s(t._f("currency")(Math.floor(t.carts.finalTotal)))+" ")]):t._e(),e("div",{staticClass:"row justify-content-end"},[e("div",{staticClass:"col-md-6"},[e("div",{staticClass:"input-group input-group my-3"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.coupon.coupon_code,expression:"coupon.coupon_code"}],staticClass:"form-control",attrs:{type:"text",placeholder:"請輸入優惠碼",readonly:t.carts.total!==t.carts.finalTotal},domProps:{value:t.coupon.coupon_code},on:{input:function(a){a.target.composing||t.$set(t.coupon,"coupon_code",a.target.value)}}}),e("div",{staticClass:"input-group-append"},[t.carts.total===t.carts.finalTotal?e("button",{staticClass:"btn btn-sm btn-outline-highlight",attrs:{type:"button"},on:{click:t.addCouponCode}},[e("span",[t._v("套用優惠碼")])]):e("button",{staticClass:"btn btn-sm btn-outline-highlight",attrs:{type:"button"},on:{click:t.removeCouponCode}},[t._m(2)])])])])]),e("div",{staticClass:"d-flex flex-column flex-sm-row justify-content-between"},[e("router-link",{staticClass:"btn btn-primary mb-3 mb-sm-0",attrs:{to:"/products"}},[e("i",{staticClass:"fas fa-arrow-left"}),t._v(" 繼續購物")]),e("button",{staticClass:"btn btn-danger",attrs:{type:"button"},on:{click:function(a){t.current="order-info"}}},[t._v(" 下一步，填寫訂購資料 "),e("i",{staticClass:"fas fa-arrow-right"})])],1)]):t._e()]):"order-info"===t.current?e("div",{staticClass:"mb-5 row justify-content-center"},[e("validation-observer",{staticClass:"col-md-10",attrs:{tag:"div"},scopedSlots:t._u([{key:"default",fn:function(a){var s=a.handleSubmit;return[e("form",{on:{submit:function(a){return a.preventDefault(),s(t.submitOrder)}}},[e("div",{staticClass:"form-group"},[e("validation-provider",{attrs:{tag:"div",name:"Email",rules:"required|email"},scopedSlots:t._u([{key:"default",fn:function(a){var s=a.errors,o=a.classes,r=a.passed;return[e("label",{attrs:{for:"useremail"}},[t._v("Email"),e("span",{staticClass:"text-danger"},[t._v(" *必填")])]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.user.email,expression:"form.user.email"}],staticClass:"form-control",class:o,attrs:{id:"useremail",type:"email",name:"email",placeholder:"請輸入 Email(xxx@xxx.xxx)"},domProps:{value:t.form.user.email},on:{input:function(a){a.target.composing||t.$set(t.form.user,"email",a.target.value)}}}),e("span",{staticClass:"invalid-feedback"},[t._v(t._s(s[0]))]),r?e("span",{staticClass:"valid-feedback"},[t._v("Email 格式正確")]):t._e()]}}],null,!0)})],1),e("div",{staticClass:"form-group"},[e("validation-provider",{attrs:{tag:"div",name:"收件人姓名",rules:"required"},scopedSlots:t._u([{key:"default",fn:function(a){var s=a.errors,o=a.classes;return[e("label",{attrs:{for:"username"}},[t._v("收件人姓名"),e("span",{staticClass:"text-danger"},[t._v(" *必填")])]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.user.name,expression:"form.user.name"}],staticClass:"form-control",class:o,attrs:{id:"username",type:"text",name:"username",placeholder:"請輸入收件人姓名"},domProps:{value:t.form.user.name},on:{input:function(a){a.target.composing||t.$set(t.form.user,"name",a.target.value)}}}),e("span",{staticClass:"invalid-feedback"},[t._v(t._s(s[0]))])]}}],null,!0)})],1),e("div",{staticClass:"form-group"},[e("validation-provider",{attrs:{tag:"div",name:"電話",rules:{required:!0,regex:/^09\d{8}$|^\d{2,4}-\d{7,8}$/}},scopedSlots:t._u([{key:"default",fn:function(a){var s=a.errors,o=a.classes,r=a.passed;return[e("label",{attrs:{for:"usertel"}},[t._v("電話"),e("span",{staticClass:"text-danger"},[t._v(" *必填")])]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.user.tel,expression:"form.user.tel"}],staticClass:"form-control",class:o,attrs:{id:"usertel",type:"text",name:"usertel",placeholder:"請輸入電話(09xxxxxxxx、02-xxxxxxxx)"},domProps:{value:t.form.user.tel},on:{input:function(a){a.target.composing||t.$set(t.form.user,"tel",a.target.value)}}}),e("span",{staticClass:"invalid-feedback"},[t._v(t._s(s[0]))]),r?e("span",{staticClass:"valid-feedback"},[t._v("電話 格式正確")]):t._e()]}}],null,!0)})],1),e("div",{staticClass:"form-group"},[e("validation-provider",{attrs:{tag:"div",name:"收件人地址",rules:"required"},scopedSlots:t._u([{key:"default",fn:function(a){var s=a.errors,o=a.classes;return[e("label",{attrs:{for:"useraddress"}},[t._v("收件人地址"),e("span",{staticClass:"text-danger"},[t._v(" *必填")])]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.user.address,expression:"form.user.address"}],staticClass:"form-control",class:o,attrs:{id:"useraddress",type:"text",name:"useraddress",placeholder:"請輸入地址"},domProps:{value:t.form.user.address},on:{input:function(a){a.target.composing||t.$set(t.form.user,"address",a.target.value)}}}),e("span",{staticClass:"invalid-feedback"},[t._v(t._s(s[0]))])]}}],null,!0)})],1),e("div",{staticClass:"form-group"},[e("validation-provider",{attrs:{tag:"div",name:"留言",rules:"max:20"},scopedSlots:t._u([{key:"default",fn:function(a){var s=a.errors,o=a.classes;return[e("label",{attrs:{for:"comment"}},[t._v("留言")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.form.message,expression:"form.message"}],staticClass:"form-control",class:o,attrs:{name:"comment",id:"comment",cols:"30",rows:"10",placeholder:"請輸入留言(最多20個字)"},domProps:{value:t.form.message},on:{input:function(a){a.target.composing||t.$set(t.form,"message",a.target.value)}}}),e("span",{staticClass:"invalid-feedback"},[t._v(t._s(s[0]))])]}}],null,!0)})],1),e("div",{staticClass:"d-flex flex-column flex-sm-row justify-content-between"},[e("button",{staticClass:"btn btn-primary mb-3 mb-sm-0",attrs:{type:"button"},on:{click:function(a){t.current="cart-list"}}},[e("i",{staticClass:"fas fa-arrow-left"}),t._v(" 回上一步 ")]),e("button",{staticClass:"btn btn-danger",attrs:{type:"submit"}},[t._v(" 送出訂單 "),e("i",{staticClass:"fas fa-arrow-right"})])])])]}}])})],1):t._e()])],1)])},o=[function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("li",{staticClass:"step-item flex-grow-1 py-4"},[e("h4",[t._v("STEP/3")]),e("p",{staticClass:"mb-0"},[t._v("成立訂單")])])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("thead",{staticClass:"checkout-cart-thead"},[e("th",{staticClass:"w-15"}),e("th",{staticClass:"w-15 d-none d-md-table-cell"}),e("th",{staticClass:"w-20"},[t._v("品名")]),e("th",{staticClass:"pdNumber"},[t._v("數量")]),e("th",[t._v("單價")]),e("th",[t._v("總價")])])},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("i",{staticClass:"fas fa-times-circle"},[e("span",[t._v(" 刪除優惠碼")])])}],r=e("5530"),c=(e("99af"),e("159b"),{data:function(){return{isLoading:!1,coupon:{coupon_code:"",percent:1},carts:JSON.parse(localStorage.getItem("tempCarts"))||{carts:[],total:0,finalTotal:0},form:{user:{name:"",email:"",tel:"",address:""},message:""},current:"cart-list",pdsNum:[]}},methods:{getCarts:function(){var t=this,a="".concat("https://vue-course-api.hexschool.io","/api/").concat("neil0907","/cart");t.isLoading=!0,t.$http.get(a).then((function(a){t.carts=a.data.data,t.isLoading=!1}))},addtoCart:function(t,a){var e=this,s="".concat("https://vue-course-api.hexschool.io","/api/").concat("neil0907","/cart");e.isLoading=!0;var o={product_id:t,qty:a};e.$http.post(s,{data:Object(r["a"])({},o)}).then((function(t){e.getCarts()}))},removeCart:function(t){this.$bus.$emit("removeCarts",t)},changePdNum:function(t,a){var e=this;e.carts.total+=(t.qty-e.pdsNum[a])*t.price,e.pdsNum[a]=t.qty,e.carts.finalTotal="coupon"in e.carts?Math.floor(e.carts.total*e.coupon.percent):e.carts.total,localStorage.setItem("tempCarts",JSON.stringify(e.carts)),e.$bus.$emit("updateCarts")},addCouponCode:function(){var t=this;if(""===t.coupon.coupon_code)t.$bus.$emit("message:push","優惠碼不可為空","danger");else{if("happy66!"===t.coupon.coupon_code){if(t.carts.finalTotal<666)return t.$bus.$emit("message:push","金額未滿666","warning"),void(t.coupon.coupon_code="");t.carts.finalTotal=.66*t.carts.total,t.coupon.percent=.66,t.$bus.$emit("message:push","已套用優惠券: ".concat(t.coupon.coupon_code),"success")}else if("happy1!"===t.coupon.coupon_code){if(t.carts.finalTotal<1e3)return t.$bus.$emit("message:push","金額未滿1000","warning"),void(t.coupon.coupon_code="");t.carts.finalTotal=.11*t.carts.total,t.coupon.percent=.11,t.$bus.$emit("message:push","已套用優惠券: ".concat(t.coupon.coupon_code),"success")}else"panda8!"===t.coupon.coupon_code?(t.carts.finalTotal=.8*t.carts.total,t.coupon.percent=.8,t.$bus.$emit("message:push","已套用優惠券: ".concat(t.coupon.coupon_code),"success")):(t.$bus.$emit("message:push","無此優惠券: ".concat(t.coupon.coupon_code),"danger"),t.coupon.coupon_code="",t.coupon.percent=1);t.$set(t.carts,"coupon",t.coupon),localStorage.setItem("tempCarts",JSON.stringify(t.carts)),t.$bus.$emit("updateCarts")}},removeCouponCode:function(){var t=this;t.$bus.$emit("message:push","已移除優惠券: ".concat(t.coupon.coupon_code),"success"),t.$delete(t.carts,"coupon"),t.coupon.coupon_code="",t.coupon.percent=1,t.carts.finalTotal=t.carts.total,localStorage.setItem("tempCarts",JSON.stringify(t.carts)),t.$bus.$emit("updateCarts")},submitOrder:function(){var t=this,a="".concat("https://vue-course-api.hexschool.io","/api/").concat("neil0907","/cart");t.isLoading=!0,t.axios.get(a).then((function(t){return t.data.data.carts})).then((function(e){var s=e;s.forEach((function(e){a="".concat("https://vue-course-api.hexschool.io","/api/").concat("neil0907","/cart/").concat(e.id),t.axios.delete(a).then((function(){}))}))})).then((function(){t.carts.carts.forEach((function(e,s){var o={product_id:e.id,qty:e.qty};a="".concat("https://vue-course-api.hexschool.io","/api/").concat("neil0907","/cart"),t.axios.post(a,{data:Object(r["a"])({},o)}).then((function(){if(s===t.carts.carts.length-1)if(localStorage.removeItem("tempCarts"),t.$bus.$emit("updateCarts"),t.coupon.coupon_code){a="".concat("https://vue-course-api.hexschool.io","/api/").concat("neil0907","/coupon");var e={code:t.coupon.coupon_code};t.$http.post(a,{data:Object(r["a"])({},e)}).then((function(a){a.data.success&&t.createOrder()}))}else t.createOrder()}))}))}))},createOrder:function(){var t=this,a="".concat("https://vue-course-api.hexschool.io","/api/").concat("neil0907","/order");t.isLoading=!0;var e=Object(r["a"])({},t.form);t.$http.post(a,{data:Object(r["a"])({},e)}).then((function(a){a.data.success&&t.$router.push("/payment/".concat(a.data.orderId)),t.isLoading=!1}))}},created:function(){var t=this;t.$bus.$on("updateCarts",(function(){t.carts=JSON.parse(localStorage.getItem("tempCarts"))||{carts:[],total:0,finalTotal:0}})),t.coupon=t.carts.coupon||{coupon_code:"",percent:1},t.carts.carts.forEach((function(a){return t.pdsNum.push(a.qty)}))}}),n=c,i=e("2877"),l=Object(i["a"])(n,s,o,!1,null,null,null);a["default"]=l.exports},"99af":function(t,a,e){"use strict";var s=e("23e7"),o=e("d039"),r=e("e8b5"),c=e("861d"),n=e("7b0b"),i=e("50c4"),l=e("8418"),u=e("65f0"),d=e("1dde"),p=e("b622"),m=e("2d00"),f=p("isConcatSpreadable"),v=9007199254740991,h="Maximum allowed index exceeded",g=m>=51||!o((function(){var t=[];return t[f]=!1,t.concat()[0]!==t})),_=d("concat"),C=function(t){if(!c(t))return!1;var a=t[f];return void 0!==a?!!a:r(t)},b=!g||!_;s({target:"Array",proto:!0,forced:b},{concat:function(t){var a,e,s,o,r,c=n(this),d=u(c,0),p=0;for(a=-1,s=arguments.length;a<s;a++)if(r=-1===a?c:arguments[a],C(r)){if(o=i(r.length),p+o>v)throw TypeError(h);for(e=0;e<o;e++,p++)e in r&&l(d,p,r[e])}else{if(p>=v)throw TypeError(h);l(d,p++,r)}return d.length=p,d}})}}]);
//# sourceMappingURL=chunk-76d3625e.505baeaa.js.map